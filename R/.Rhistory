,values_to = "Val")%>%
ggplot(aes( x=Year
,y=Val
,fill=Var))+
theme_economist()+
geom_line( aes(color=Var),linewidth=1.5)
sum(compare$d)
d_square_sum<-sum(compare$d_square)
n<-nrow(compare)
rho_s<-(1-(6*(sum(d_square_sum)))/(n*(n^2-1)))%>%round(2)
rho_s
library(ggpubr)
ggscatter( compare
,x ="Rate UCR"
,y ="Rate NCVS"
,color = "blue"
,cor.coef = TRUE
,cor.method = "spearman"
,xlab = "UCR Rate"
,ylab ="NCVS Rate"
,title="Comparing Rates of Victim Self-Report(NCVS) to LE Reporting(UCR)")+
theme_economist()
install.packages(c("arules", "askpass", "brew", "brio", "bslib", "chromote", "classInt", "cli", "cowplot", "cpp11", "crosstalk", "curl", "data.table", "dbplyr", "deldir", "desc", "dplyr", "DT", "e1071", "evaluate", "fansi", "fontawesome", "forecast", "gdtools", "ggplot2", "ggrepel", "ggthemes", "graphlayouts", "gt", "gtable", "gtExtras", "haven", "htmltools", "htmlwidgets", "httpuv", "httr", "igraph", "jsonlite", "knitr", "labeling", "later", "lava", "leaflet", "leaflet.extras2", "leaflet.providers", "lifecycle", "lpSolve", "lubridate", "maps", "mapview", "markdown", "openssl", "pals", "pdftools", "pkgbuild", "plotly", "prettyunits", "processx", "prodlim", "progress", "progressr", "promises", "purrr", "quantmod", "ragg", "raster", "RcppArmadillo", "reactR", "recipes", "rematch", "rlang", "rmarkdown", "rsample", "s2", "sass", "scales", "seriation", "servr", "sf", "shiny", "slider", "sp", "spdep", "stringi", "stringr", "svglite", "systemfonts", "terra", "tesseract", "textshaping", "tidygraph", "tigris", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "TTR", "units", "utf8", "uuid", "V8", "vctrs", "viridis", "vroom", "warp", "webshot2", "withr", "wk", "xfun", "xml2", "yaml"))
library(readr)
Percent_of_violent_crime_excluding_simple_assault_victimizations_by_victim_offender_relationship_2021_vs_2022 <- read_csv("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
View(Percent_of_violent_crime_excluding_simple_assault_victimizations_by_victim_offender_relationship_2021_vs_2022)
source('~/GitHub/HoustonCrimeDataAnalysis/R/Percent_of_violent_crime_excluding_simple_assault_victimizations_by_victim_offender_relationship_2021_vs_2022.R')
View(data)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
View(data)
View(data)
View(data)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
exp_prp<-data[Year==2021]
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$number<-as.integer(data$number)
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$number<-as.integer(data$number)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$number<-as.integer(data$number)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$number<-as.integer(data$number)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(data$Number)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
View(data)
View(data)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
View(exp_prp)
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
data[Year==2021,exp_p:=Number/sum(Number)]
View(exp_prp)
View(data)
View(data)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
#data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,exp_p:=Number/sum(Number)]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
#data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,(exp_p:=Number/sum(Number))]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,(exp_p=Number/sum(Number))]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
View(obs_cts)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts, p=exp_prp)
View(exp_prp)
View(obs_cts)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))][1]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts, p=exp_prp)
View(exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts, p=exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))][[1]]
obs_cts<-data[Year==2022,.(Number)][[1]]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))][[1]]
obs_cts<-data[Year==2022,.(Number)][[1]]
chisq.test(x=obs_cts, p=exp_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))][[1]]
obs_cts<-data[Year==2022,.(Number)][[1]]
chisq.test(x=obs_cts, p=exp_prp)
obs_prp<-data[Year==2022,.(obs_p=Number/sum(Number))][[1]]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))][[1]]
obs_cts<-data[Year==2022,.(Number)][[1]]
chisq.test(x=obs_cts, p=exp_prp)
obs_prp<-data[Year==2022,.(obs_p=Number/sum(Number))]
View(obs_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts[[1]], p=exp_prp[[1]])
obs_prp<-data[Year==2022,.(obs_p=Number/sum(Number))]
View(exp_prp)
View(obs_prp)
View(obs_prp)
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts[[1]], p=exp_prp[[1]])
obs_prp<-data[Year==2022,.(obs_p=Number/sum(Number))]
exp_prp$exp_p<-data[Year==2021,.(exp_p=Number/sum(Number))]
exp_prp$exp_p<-data[Year==2021,.(exp_p=Number/sum(Number))]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp$exp_p<-data[Year==2021,.(exp_p=Number/sum(Number))]
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts[[1]], p=exp_prp[[1]])
obs_prp<-data[Year==2022,.(obs_p=Number/sum(Number))]
View(data)
exp_cts<-data[Year==2022,.(sum(Number))]
View(exp_cts)
exp_cts<-exp_prp*data[Year==2022,.(sum(Number))]
exp_cts<-exp_prp*data[Year==2022,.(sum(Number))][[1]]
View(exp_cts)
View(obs_cts)
View(obs_cts)
View(exp_cts)
((obs_cts-exp_cts)^2)/epx_cts
library(readr)
library(data.table)
data<-fread("C:/Users/chris/Downloads/Percent of violent crime excluding simple assault victimizations by victim-offender relationship, 2021 vs. 2022.csv")
data$Number<-as.integer(gsub(",", "",data$Number))
exp_prp<-data[Year==2021,.(exp_p=Number/sum(Number))]
obs_cts<-data[Year==2022,.(Number)]
chisq.test(x=obs_cts[[1]], p=exp_prp[[1]])
exp_cts<-exp_prp*data[Year==2022,.(sum(Number))][[1]]
((obs_cts-exp_cts)^2)/exp_cts
View(data)
library(DBI)
mydb <- dbConnect(RSQLite::SQLite(), "C:/Users/chris/Documents/GitHub/HoustonCrimeDataAnalysis/DATA/Data/Database/HPD_NIBRS.sqlite")
install.packages("RSQLite")
library(DBI)
mydb <- dbConnect(RSQLite::SQLite(), "C:/Users/chris/Documents/GitHub/HoustonCrimeDataAnalysis/DATA/Data/Database/HPD_NIBRS.sqlite")
dbDisconnect(mydb)
mtcars %$% subset(cyl > 6)
library(tidyverse)
library(magrittr)
mtcars %$% subset(cyl > 6)
mtcars %>% subset(cyl > 6)
mtcars %$%
library(tidyverse)
library(magrittr)
mtcars %$% min()
library(tidyverse)
library(magrittr)
mtcars %$% plot(hp, mpg)
library("readxl")
library("glue")
library("tidyverse")
library("data.table")
library("zoo")
library("ggplot2")
library("ggthemes")
library("leaflet")
library('sf')
library('sfdep')
library('dplyr')
library('htmlwidgets')
library('DBI')
setwd('C:/Users/chris/Documents/GitHub/HoustonCrimeDataAnalysis/R')
source('NIBRS_Trendx.R')
source('YTD_NIBRS.R')
source('GEOPLOT.R')
sf_use_s2(FALSE)
where_the_data_is<-'C:/Users/chris/Documents/Houston_Crime_Data_Analysis/DATA'
support_dir<-'C:/Users/chris/Documents/Houston_Crime_Data_Analysis/DATA/Support/'
db_name<-'HPD_NIBRS'
NCVS_violent_wts<-list( `2019`=2.15
,`2020`=2.03
,`2021`=1.92
,`2022`=2.08
)
NCVS_violent_wts['2023']<-mean(unlist(NCVS_violent_wts))
NCVS_property_wts<-list( `2019`=3.33
,`2020`=3.94
,`2021`=2.30
,`2022`=4.20
)
NCVS_property_wts['2023']<-mean(unlist(NCVS_property_wts))
label_year<-'2023'
label_month<-'12'
to_dt_month<-'12'
districts<-st_read(glue("{support_dir}COH_ADMINISTRATIVE_BOUNDARY_-_MIL.geojson"))%>%
filter(!is.na(DISTRICT) )
beats<-st_read(glue("{support_dir}COH_POLICE_BEATS.geojson"))
bydim<-'Overall'
group_dims<-c('NIBRSDescription',bydim)
violent_crimes<-c('Aggravated Assault'
,'Forcible rape'
,'Robbery'
,'Murder, non-negligent')
property_crimes<-c( 'Motor vehicle theft'
,'Theft from motor vehicle'
,'Theft of motor vehicle parts or accessory'
,'Burglary, Breaking and Entering'
,'All other larceny'
,'Arson')
inc_db<- dbConnect( RSQLite::SQLite()
,glue('{where_the_data_is}/{db_name}')
,extended_types = TRUE)
baseline<-dbReadTable(inc_db, 'year_19')
min(baseline$RMSOccurrenceDate)
max(baseline$RMSOccurrenceDate)
year1<-dbReadTable(inc_db, 'year_20')
min(year1$RMSOccurrenceDate)
max(year1$RMSOccurrenceDate)
year2<-dbReadTable(inc_db, 'year_21')
min(year2$RMSOccurrenceDate)
max(year2$RMSOccurrenceDate)
year3<-dbReadTable(inc_db, 'year_22')
min(year3$RMSOccurrenceDate)
max(year3$RMSOccurrenceDate)
year4<-dbReadTable(inc_db, 'year_23')
min(year4$RMSOccurrenceDate)
max(year4$RMSOccurrenceDate)
dbDisconnect(inc_db)
## MULTI YEAR
multi_year<-rbind(baseline,year1,year2,year3,year4)%>%
mutate(year_mon=floor_date(RMSOccurrenceDate,'month'))
multi_year$year<-year(multi_year$'RMSOccurrenceDate')
multi_year$Overall<-'OverAll'
all_desc<-multi_year%>%group_by(NIBRSDescription)%>%summarize(Freq=sum(OffenseCount))
all_prem<-multi_year%>%group_by(Premise)%>%summarize(Freq=sum(OffenseCount))
all_beat<-multi_year%>%group_by(Beat)%>%summarize(Freq=sum(OffenseCount))
out_db<- dbConnect( RSQLite::SQLite()
,glue('{where_the_data_is}/{db_name}')
,extended_types = TRUE)
dbWriteTable( out_db
,"multi_year"
,multi_year
,overwrite=TRUE)
dbDisconnect(out_db)
YTD_VOLUMES<-multi_year[ (NIBRSDescription %chin% violent_crimes),]%>%
.[ ( RMSOccurrenceDate>=glue('2019-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2019))
|( RMSOccurrenceDate>=glue('2020-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2020))
|( RMSOccurrenceDate>=glue('2021-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2021))
|( RMSOccurrenceDate>=glue('2022-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2022))
|( RMSOccurrenceDate>=glue('2023-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2023)),]
View(multi_year)
View(multi_year)
library("readxl")
library("glue")
library("tidyverse")
library("data.table")
library("zoo")
library("ggplot2")
library("ggthemes")
library("leaflet")
library('sf')
library('sfdep')
library('dplyr')
library('htmlwidgets')
library('DBI')
setwd('C:/Users/chris/Documents/GitHub/HoustonCrimeDataAnalysis/R')
source('NIBRS_Trendx.R')
source('YTD_NIBRS.R')
source('GEOPLOT.R')
sf_use_s2(FALSE)
where_the_data_is<-'C:/Users/chris/Documents/Houston_Crime_Data_Analysis/DATA'
support_dir<-'C:/Users/chris/Documents/Houston_Crime_Data_Analysis/DATA/Support/'
db_name<-'HPD_NIBRS'
NCVS_violent_wts<-list( `2019`=2.15
,`2020`=2.03
,`2021`=1.92
,`2022`=2.08
)
NCVS_violent_wts['2023']<-mean(unlist(NCVS_violent_wts))
NCVS_property_wts<-list( `2019`=3.33
,`2020`=3.94
,`2021`=2.30
,`2022`=4.20
)
NCVS_property_wts['2023']<-mean(unlist(NCVS_property_wts))
label_year<-'2023'
label_month<-'12'
to_dt_month<-'12'
districts<-st_read(glue("{support_dir}COH_ADMINISTRATIVE_BOUNDARY_-_MIL.geojson"))%>%
filter(!is.na(DISTRICT) )
beats<-st_read(glue("{support_dir}COH_POLICE_BEATS.geojson"))
bydim<-'Overall'
group_dims<-c('NIBRSDescription',bydim)
violent_crimes<-c('Aggravated Assault'
,'Forcible rape'
,'Robbery'
,'Murder, non-negligent')
property_crimes<-c( 'Motor vehicle theft'
,'Theft from motor vehicle'
,'Theft of motor vehicle parts or accessory'
,'Burglary, Breaking and Entering'
,'All other larceny'
,'Arson')
inc_db<- dbConnect( RSQLite::SQLite()
,glue('{where_the_data_is}/{db_name}')
,extended_types = TRUE)
baseline<-dbReadTable(inc_db, 'year_19')
min(baseline$RMSOccurrenceDate)
max(baseline$RMSOccurrenceDate)
year1<-dbReadTable(inc_db, 'year_20')
min(year1$RMSOccurrenceDate)
max(year1$RMSOccurrenceDate)
year2<-dbReadTable(inc_db, 'year_21')
min(year2$RMSOccurrenceDate)
max(year2$RMSOccurrenceDate)
year3<-dbReadTable(inc_db, 'year_22')
min(year3$RMSOccurrenceDate)
max(year3$RMSOccurrenceDate)
year4<-dbReadTable(inc_db, 'year_23')
min(year4$RMSOccurrenceDate)
max(year4$RMSOccurrenceDate)
dbDisconnect(inc_db)
## MULTI YEAR
multi_year<-rbind(baseline,year1,year2,year3,year4)%>%
mutate(year_mon=floor_date(RMSOccurrenceDate,'month'))
multi_year$year<-year(multi_year$'RMSOccurrenceDate')
multi_year$Overall<-'OverAll'
all_desc<-multi_year%>%group_by(NIBRSDescription)%>%summarize(Freq=sum(OffenseCount))
all_prem<-multi_year%>%group_by(Premise)%>%summarize(Freq=sum(OffenseCount))
all_beat<-multi_year%>%group_by(Beat)%>%summarize(Freq=sum(OffenseCount))
out_db<- dbConnect( RSQLite::SQLite()
,glue('{where_the_data_is}/{db_name}')
,extended_types = TRUE)
dbWriteTable( out_db
,"multi_year"
,multi_year
,overwrite=TRUE)
dbDisconnect(out_db)
YTD_VOLUMES<-setDT(multi_year)[ (NIBRSDescription %chin% violent_crimes),]%>%
.[ ( RMSOccurrenceDate>=glue('2019-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2019))
|( RMSOccurrenceDate>=glue('2020-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2020))
|( RMSOccurrenceDate>=glue('2021-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2021))
|( RMSOccurrenceDate>=glue('2022-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2022))
|( RMSOccurrenceDate>=glue('2023-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2023)),]
ETL_VALIDATE<-function(){
qa_year_mon<-multi_year%>%
group_by(year_mon)%>%
summarize(Row_Count=n())%>%
filter()
qa_year_mon$year_mon<-as.Date(qa_year_mon$year_mon)
str(qa_year_mon)
ggplot( data=qa_year_mon
,aes( x=year_mon
,y=Row_Count))+
geom_bar(stat="identity")+
scale_x_date( breaks = date_breaks("months")
,labels = date_format("%b-%Y")
,expand = c(.01, .01))+
theme(axis.text.x = element_text( angle = 90
,vjust = 0.5
,hjust=1))+
#  Labelling as desired
labs(
title = "Row-Counts By Year-Month"
#,subtitle = "SUB"
#,caption = "Caption"
)
qa_year_by_year_mon<-multi_year%>%group_by(year_mon,year)%>%summarize(freq=n())
YTD_VOLUMES<-multi_year[ (NIBRSDescription %chin% violent_crimes),]%>%
.[ ( RMSOccurrenceDate>=glue('2019-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2019))
|( RMSOccurrenceDate>=glue('2020-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2020))
|( RMSOccurrenceDate>=glue('2021-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2021))
|( RMSOccurrenceDate>=glue('2022-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2022))
|( RMSOccurrenceDate>=glue('2023-01-01')
&RMSOccurrenceDate<=eom(to_dt_month,2023)),]
year_vol<-YTD_VOLUMES%>%group_by(year)%>%summarize(freq=n())
ggplot( data=year_vol
,aes( x=year
,y=freq))+
geom_bar(stat="identity")
}
## DB LOAD
## NEW DB PER-MONTH, or overall
#mydb <- dbConnect(RSQLite::SQLite(), "")
#dbWriteTable(mydb, "mtcars", mtcars)
#dbWriteTable(mydb, "iris", iris)
#dbListTables(mydb)
#dbDisconnect(mydb)
## Manual Housekeeping
#remove(list=c('YTD_VOLUMES'))
#remove(list=c('baseline','year1','year2','year3','year4'))
View(YTD_VOLUMES)
View(YTD_VOLUMES)
